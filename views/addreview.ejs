<!doctype html>
<html>
  <head>
    <title><%= forumName %> - Add Review</title>
    <link rel="stylesheet" type="text/css" href="/main.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  </head>
  <body>
    <%- include('./partials/header.ejs'); -%>
    <div class="container">
      <h2>Add a New Review</h2>
      <form id="bookSearchForm">
        <div class="form-group">
            <label for="bookSearch">Search Book:</label>
            <input type="text" id="bookSearch" name="bookSearch" required />
            <button type="submit" class="btn">Search</button>
        </div>
      </form>
      
      <div id="bookList" class="search-results"></div>

      <div class="card">
        <form method="POST" action="/reviewadded">
          <div class="form-group">
            <label for="bookName">Book Name:</label>
            <input type="text" name="name" id="bookName" required />
          </div>
          <div class="form-group">
            <label for="isbn">ISBN:</label>
            <input type="text" name="isbn" id="isbn" required />
          </div>
          <div class="form-group">
            <label for="reviewText">Review Text:</label>
            <textarea name="reviewText" required></textarea>
          </div>
          <div class="form-group">
            <label for="rating">Rating:</label>
            <input type="number" name="rating" min="1" max="5" required />
          </div>
          <button type="submit" class="btn">Submit Review</button>
        </form>
      </div>
    </div>

    <% if (errormessage) { %>
        <p class="error"><%= errormessage %></p>
    <% } %>

    <script>
      $(document).ready(function() {
        $('#bookSearchForm').on('submit', function(e) {
          e.preventDefault();
          var query = $('#bookSearch').val();
          $('#bookList').empty();
    
          if (query.length > 2) {
            $.getJSON("/searchBooks?q=" + query, function(data) {
              if (data.items) {
                data.items.forEach(function(item) {
                  $('#bookList').append('<div class="book-item" data-isbn="' + (item.volumeInfo.industryIdentifiers ? item.volumeInfo.industryIdentifiers[0].identifier : '') + '" data-name="' + item.volumeInfo.title + '">' + item.volumeInfo.title + '</div>');
                });
              } else {
                $('#bookList').append('<p>No books found. Please try a different search.</p>');
              }
    
              $('.book-item').click(function() {
                var isbn = $(this).data('isbn');
                var name = $(this).data('name');
                $('#isbn').val(isbn);
                $('#bookName').val(name);
                $('#bookList').empty();
              });
            });
          }
        });
      });
    </script>
  </body>
</html>
